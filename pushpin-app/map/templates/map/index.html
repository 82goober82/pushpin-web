<!DOCTYPE HTML>
{% load staticfiles %}
<html>
<head>
<title>Pushpin - Map</title>
<meta charset="UTF-8">

<!-- js libs go here -->
<script src="http://maps.google.com/maps/api/js?sensor=false" charset="utf-8"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js" charset="utf-8"></script>
<script src="https://code.jquery.com/jquery-2.1.1.min.js" charset="utf-8"></script>
<script src="{% static "js/facebox.js" %}" charset="utf-8"></script>

<!-- css goes here -->
<link rel="stylesheet" type="text/css" href="{% static "css/main.css" %}" />
<link rel="stylesheet" type="text/css" href="{% static "css/facebox.css" %}" />

<script type="text/javascript">

// NOTE: this is only here so that it can be used with templating
// TODO: use AJAX to get this data instead
var rawData = {{ pushpins|safe }};
var cleanData = [];

var GLOBAL = {
  faceboxCloseImage: '{% static "images/closelabel.png" %}',
  faceboxLoadingImage: '{% static "images/loading.gif" %}',
};

function init() {
  // this is called on load from main.js
  // having this here is very hacky
  rawData.forEach( function(datum) {
    cleanData.push(datum.fields);
    });

  MAP.createMap({{ location.latitude }},
                {{ location.longitude }},
                {{ location.radius }},
                window.cleanData
               ); // creates the map

  TIMELINE.createTimeline(window.cleanData); // creates the d3.js timeline
}

google.maps.event.addDomListener(window, 'load', init);

</script>

<!-- custom js goes here -->
<script src="{% static "js/main.js" %}" charset="utf-8"></script>
<script src="{% static "js/timeline.js" %}" charset="utf-8"></script>
<script src="{% static "js/map.js" %}" charset="utf-8"></script>


</head>
<body>
    <div id="nav" class="nav rounded shaded">
        <div id="filter">
          {% for source in sources %}
            <input type="checkbox" id="{{ source }}" onchange="MAP.toggleMarkers('{{ source }}');" checked="checked"/>{{ source }}<br />
          {% endfor %}
        </div>
        <div id="summary"></div>
    </div>

    <div class="map" id="map"></div>
    <div id="locations">
      <a href="#new-location" rel="facebox">
        <center>Create New Location</center>
      </a>
      <table>
        <thead>
        <tr>
          <td> Location Name </td>
          <td> Lat </td>
          <td> Lon </td>
          <td> Radius</td>
          <td> Created </td>
        </tr>
        </thead>
        <tbody>
        {% for loc in locations %}
        <tr onclick="document.location = '{% url 'map location' loc.name %}'">
            <td> {{ loc.name|truncatechars:15 }} </td>
            <td> {{ loc.latitude }} </td>
            <td> {{ loc.longitude }} </td>
            <td> {{ loc.radius }} </td>
            <td> {{ loc.date|date:"m/d/y" }} </td>
          </tr>
        </tbody>
        {% endfor %}
      </table>
    </div>
    <div id="timeline"></div>
    <div class="overlay" id="new-location">
      <form id="new-location-form">
        This is where users will add new locations.
      </form>
    </div>
</body>
</html>
